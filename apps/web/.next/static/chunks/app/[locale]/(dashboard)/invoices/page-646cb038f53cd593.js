(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4154],{66542:(e,a,r)=>{Promise.resolve().then(r.bind(r,82957))},82957:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>K});var s=r(95155),l=r(12115),t=r(7266),i=r(39124),n=r(67396),d=r(14081),c=r(28283),o=r(73239),u=r(61594),g=r(75340),x=r(33473),m=r(20853),b=r(84267),h=r(44857),p=r(14505),y=r(84858),v=r(92598),f=r(26764),j=r(23920),N=r(66462),k=r(45686),w=r(93518),C=r(46967),A=r(13556),S=r(32162),D=r(1466),F=r(32423),R=r(60719),z=r(34592),V=r(30814),P=r(43463),I=r(69795),O=r(98867),E=r(40767);function U(e){let a=e.replace(/\s+/g,"").toUpperCase();if(a.startsWith("RO")&&(a=a.substring(2)),!/^\d+$/.test(a))return{isValid:!1,formatted:a,error:"CUI-ul trebuie să conțină doar cifre"};if(a.length<2||a.length>10)return{isValid:!1,formatted:a,error:"CUI-ul trebuie să aibă \xeentre 2 și 10 cifre"};let r=a.padStart(10,"0").split("").map(Number),s=r.pop(),l=0;for(let e=0;e<9;e++)l+=r[e]*parseInt("753217532"[e]);let t=10*l%11;return(10===t&&(t=0),t!==s)?{isValid:!1,formatted:a,error:"CUI invalid - cifra de control nu corespunde"}:{isValid:!0,formatted:a}}function T(e){let{value:a="",onChange:r,onCompanyData:t,showValidation:i=!0,autoFetch:n=!1,label:d="CUI / CIF",error:c,className:o,disabled:u,...g}=e,[x,b]=(0,l.useState)(a),[h,y]=(0,l.useState)(null),[v,f]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),k=void 0!==a?a:x,w=(0,l.useCallback)(e=>{let a=e.target.value.toUpperCase();if(b(a),N(null),a.length<2){y(null),null==r||r(a,!1);return}let s=U(a);y({isValid:s.isValid,error:s.error}),null==r||r(s.formatted,s.isValid)},[r]),C=(0,l.useCallback)(async()=>{let e=k.replace(/^RO/i,"").replace(/\s+/g,"");if(!e||e.length<2)return;let a=U(e);if(!a.isValid){y(a);return}f(!0);try{let a=await fetch("/api/v1/anaf/company/".concat(e));if(a.ok){let e=await a.json();e.data&&(N(e.data),null==t||t(e.data))}else N(null),null==t||t(null)}catch(e){console.error("Error fetching company data:",e),N(null),null==t||t(null)}finally{f(!1)}},[k,t]),A=(0,l.useCallback)(()=>{if(k.length>=2){let e=U(k);y({isValid:e.isValid,error:e.error}),e.isValid&&n&&C()}},[k,n,C]),S=c||(null==h?void 0:h.error);return(0,s.jsxs)("div",{className:"space-y-2",children:[d&&(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:k,onChange:w,onBlur:A,disabled:u||v,placeholder:"Introdu CUI-ul (ex: 12345678 sau RO12345678)",className:function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,I.QP)((0,P.$)(a))}("w-full px-4 py-2.5 pr-20 rounded-lg border transition-colors","bg-white dark:bg-gray-800","focus:outline-none focus:ring-2",S?"border-red-300 dark:border-red-700 focus:ring-red-500 focus:border-red-500":(null==h?void 0:h.isValid)?"border-green-300 dark:border-green-700 focus:ring-green-500 focus:border-green-500":"border-gray-200 dark:border-gray-700 focus:ring-blue-500 focus:border-blue-500",u&&"opacity-50 cursor-not-allowed",o),...g}),(0,s.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[i&&k.length>=2&&(0,s.jsx)(s.Fragment,{children:v?(0,s.jsx)(p.A,{className:"w-5 h-5 text-blue-500 animate-spin"}):(null==h?void 0:h.isValid)?(0,s.jsx)(O.A,{className:"w-5 h-5 text-green-500"}):(null==h?void 0:h.error)?(0,s.jsx)(E.A,{className:"w-5 h-5 text-red-500"}):null}),!n&&(null==h?void 0:h.isValid)&&!j&&(0,s.jsx)("button",{type:"button",onClick:C,disabled:v,className:"p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Caută firma \xeen baza ANAF",children:(0,s.jsx)(m.A,{className:"w-4 h-4 text-gray-500"})})]})]}),S&&(0,s.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:S}),j&&(0,s.jsxs)("div",{className:"mt-2 p-3 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:[(0,s.jsx)("p",{className:"font-medium text-green-800 dark:text-green-200",children:j.denumire}),(0,s.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:j.adresa}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2 text-xs",children:[j.nrRegCom&&(0,s.jsxs)("span",{className:"px-2 py-0.5 rounded bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300",children:["Reg. Com.: ",j.nrRegCom]}),j.tvaAttr&&(0,s.jsx)("span",{className:"px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300",children:"Plătitor TVA"})]})]})]})}let M=()=>Math.random().toString(36).substr(2,9),q=()=>({id:M(),description:"",quantity:1,unit:"buc",unitPrice:0,vatRate:19,total:0}),L=e=>e.toISOString().split("T")[0],_=[{value:19,label:"19% (Standard)"},{value:9,label:"9% (Redus)"},{value:5,label:"5% (Redus)"},{value:0,label:"0% (Scutit)"}],$=[{value:"buc",label:"Bucăți (buc)"},{value:"kg",label:"Kilograme (kg)"},{value:"l",label:"Litri (l)"},{value:"m",label:"Metri (m)"},{value:"m\xb2",label:"Metri pătrați (m\xb2)"},{value:"h",label:"Ore (h)"},{value:"zi",label:"Zile"},{value:"luna",label:"Luni"}];function B(e){let{isOpen:a,onClose:r,onSuccess:i,invoice:n}=e;(0,t.useTranslations)("invoices");let{selectedCompanyId:d}=(0,S.o)(),{data:c}=(0,A.aq)(d||""),{data:o}=(0,A.QT)(d||""),u=(0,A.Jz)(d||""),[g,m]=(0,l.useState)({clientId:"",clientName:"",clientCui:"",clientAddress:"",issueDate:L(new Date),dueDate:L(new Date(Date.now()+2592e6)),currency:"RON",notes:"",items:[q()]}),[b,h]=(0,l.useState)(!1),p=(null==c?void 0:c.data)||[],y=(null==o?void 0:o.data)||[];(0,l.useEffect)(()=>{a&&(n?m(n):m({clientId:"",clientName:"",clientCui:"",clientAddress:"",issueDate:L(new Date),dueDate:L(new Date(Date.now()+2592e6)),currency:"RON",notes:"",items:[q()]}),h(!1))},[a,n]);let v=e=>e.quantity*e.unitPrice,{subtotal:f,vatAmount:j,total:N}=(()=>{let e=g.items.reduce((e,a)=>e+v(a),0),a=g.items.reduce((e,a)=>e+v(a)*a.vatRate/100,0);return{subtotal:e,vatAmount:a,total:e+a}})(),w=e=>{if("new"===e)h(!0),m(e=>({...e,clientId:"",clientName:"",clientCui:"",clientAddress:""}));else{h(!1);let a=p.find(a=>a.id===e);a&&m(e=>({...e,clientId:a.id,clientName:a.name,clientCui:a.cui||"",clientAddress:a.address||""}))}},C=(e,a)=>{m(r=>({...r,items:r.items.map((r,s)=>s===e?{...r,...a,total:v({...r,...a})}:r)}))},P=(e,a)=>{let r=y.find(a=>a.id===e);r&&C(a,{productId:r.id,description:r.name,unitPrice:r.price||0,unit:r.unit||"buc",vatRate:r.vatRate||19})},I=e=>{g.items.length>1&&m(a=>({...a,items:a.items.filter((a,r)=>r!==e)}))},O=async e=>{if(e.preventDefault(),!g.clientName){V.o.error("Selectează sau adaugă un client");return}if(0===g.items.length||g.items.every(e=>!e.description)){V.o.error("Adaugă cel puțin un articol pe factură");return}try{await u.mutateAsync({...g,items:g.items.filter(e=>e.description)}),V.o.success("Factura a fost creată cu succes"),null==i||i(),r()}catch(e){V.o.error("Eroare la crearea facturii"),console.error(e)}},E=e=>new Intl.NumberFormat("ro-RO",{style:"currency",currency:g.currency}).format(e);return(0,s.jsx)(z.aF,{isOpen:a,onClose:r,title:n?"Editează Factura":"Factură Nouă",description:"Completează detaliile pentru a genera factura",size:"xl",children:(0,s.jsxs)("form",{onSubmit:O,children:[(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-lg font-medium",children:[(0,s.jsx)(D.A,{className:"w-5 h-5 text-blue-600"}),(0,s.jsx)("span",{children:"Detalii Client"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nume Client *"}),(0,s.jsx)("input",{type:"text",value:g.clientName,onChange:e=>m(a=>({...a,clientName:e.target.value})),placeholder:"SC Exemplu SRL",className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsx)("div",{children:(0,s.jsx)(T,{value:g.clientCui||"",onChange:(e,a)=>{m(a=>({...a,clientCui:e}))},autoFetch:!0,onCompanyData:e=>{e&&m(a=>({...a,clientName:e.denumire||a.clientName,clientAddress:e.adresa||a.clientAddress}))},showValidation:!0})}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Adresă"}),(0,s.jsx)("input",{type:"text",value:g.clientAddress||"",onChange:e=>m(a=>({...a,clientAddress:e.target.value})),placeholder:"Strada Exemplu, Nr. 1, București",className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>h(!1),className:"text-sm text-blue-600 hover:underline",children:"← \xcenapoi la lista de clienți"})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Selectează Client"}),(0,s.jsxs)("select",{value:g.clientId,onChange:e=>w(e.target.value),className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"-- Alege client --"}),p.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.cui&&"(".concat(e.cui,")")]},e.id)),(0,s.jsx)("option",{value:"new",children:"+ Client Nou"})]})]})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-lg font-medium",children:[(0,s.jsx)(F.A,{className:"w-5 h-5 text-blue-600"}),(0,s.jsx)("span",{children:"Detalii Factură"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data Emiterii"}),(0,s.jsx)("input",{type:"date",value:g.issueDate,onChange:e=>m(a=>({...a,issueDate:e.target.value})),className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data Scadenței"}),(0,s.jsx)("input",{type:"date",value:g.dueDate,onChange:e=>m(a=>({...a,dueDate:e.target.value})),className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Monedă"}),(0,s.jsxs)("select",{value:g.currency,onChange:e=>m(a=>({...a,currency:e.target.value})),className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"RON",children:"RON - Leu rom\xe2nesc"}),(0,s.jsx)("option",{value:"EUR",children:"EUR - Euro"}),(0,s.jsx)("option",{value:"USD",children:"USD - Dolar american"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-lg font-medium",children:[(0,s.jsx)(R.A,{className:"w-5 h-5 text-blue-600"}),(0,s.jsx)("span",{children:"Articole Factură"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>{m(e=>({...e,items:[...e.items,q()]}))},className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[(0,s.jsx)(x.A,{className:"w-4 h-4"}),"Adaugă Articol"]})]}),(0,s.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"hidden md:grid md:grid-cols-12 gap-2 px-4 py-3 bg-gray-50 dark:bg-gray-800 text-sm font-medium text-gray-500",children:[(0,s.jsx)("div",{className:"col-span-4",children:"Descriere"}),(0,s.jsx)("div",{className:"col-span-1",children:"Cant."}),(0,s.jsx)("div",{className:"col-span-2",children:"U.M."}),(0,s.jsx)("div",{className:"col-span-2",children:"Preț Unitar"}),(0,s.jsx)("div",{className:"col-span-1",children:"TVA"}),(0,s.jsx)("div",{className:"col-span-1 text-right",children:"Total"}),(0,s.jsx)("div",{className:"col-span-1"})]}),(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:g.items.map((e,a)=>(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"hidden md:grid md:grid-cols-12 gap-2 items-center",children:[(0,s.jsxs)("div",{className:"col-span-4",children:[(0,s.jsx)("input",{type:"text",value:e.description,onChange:e=>C(a,{description:e.target.value}),placeholder:"Descriere produs/serviciu",className:"w-full px-2 py-1.5 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"}),y.length>0&&(0,s.jsxs)("select",{onChange:e=>P(e.target.value,a),className:"w-full mt-1 px-2 py-1 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-xs text-gray-500 focus:outline-none",children:[(0,s.jsx)("option",{value:"",children:"Sau alege produs..."}),y.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - ",E(e.price||0)]},e.id))]})]}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.quantity,onChange:e=>C(a,{quantity:parseFloat(e.target.value)||0}),className:"w-full px-2 py-1.5 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("select",{value:e.unit,onChange:e=>C(a,{unit:e.target.value}),className:"w-full px-2 py-1.5 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",children:$.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.unitPrice,onChange:e=>C(a,{unitPrice:parseFloat(e.target.value)||0}),className:"w-full px-2 py-1.5 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)("select",{value:e.vatRate,onChange:e=>C(a,{vatRate:parseInt(e.target.value)}),className:"w-full px-2 py-1.5 rounded border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",children:_.map(e=>(0,s.jsxs)("option",{value:e.value,children:[e.value,"%"]},e.value))})}),(0,s.jsx)("div",{className:"col-span-1 text-right font-medium",children:E(v(e))}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,s.jsx)("button",{type:"button",onClick:()=>I(a),disabled:1===g.items.length,className:"p-1.5 text-gray-400 hover:text-red-500 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:(0,s.jsx)(k.A,{className:"w-4 h-4"})})})]}),(0,s.jsxs)("div",{className:"md:hidden space-y-3",children:[(0,s.jsx)("input",{type:"text",value:e.description,onChange:e=>C(a,{description:e.target.value}),placeholder:"Descriere produs/serviciu",className:"w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.quantity,onChange:e=>C(a,{quantity:parseFloat(e.target.value)||0}),placeholder:"Cant.",className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.unitPrice,onChange:e=>C(a,{unitPrice:parseFloat(e.target.value)||0}),placeholder:"Preț",className:"px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium",children:E(v(e))}),(0,s.jsx)("button",{type:"button",onClick:()=>I(a),disabled:1===g.items.length,className:"p-1.5 text-gray-400 hover:text-red-500 disabled:opacity-30",children:(0,s.jsx)(k.A,{className:"w-4 h-4"})})]})]})]})]},e.id))})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("div",{className:"w-full md:w-72 space-y-2 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Subtotal:"}),(0,s.jsx)("span",{className:"font-medium",children:E(f)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"TVA:"}),(0,s.jsx)("span",{className:"font-medium",children:E(j)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t border-gray-200 dark:border-gray-700 pt-2 mt-2",children:[(0,s.jsx)("span",{children:"Total:"}),(0,s.jsx)("span",{className:"text-blue-600",children:E(N)})]})]})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Note (opțional)"}),(0,s.jsx)("textarea",{value:g.notes||"",onChange:e=>m(a=>({...a,notes:e.target.value})),placeholder:"Note sau observații pentru factură...",rows:3,className:"w-full px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]})]}),(0,s.jsxs)(z.jl,{children:[(0,s.jsx)(z.$n,{variant:"secondary",onClick:r,children:"Anulează"}),(0,s.jsx)(z.$n,{type:"submit",isLoading:u.isPending,disabled:!g.clientName||g.items.every(e=>!e.description),children:n?"Salvează Modificări":"Creează Factură"})]})]})})}let W={draft:{label:"Ciornă",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",icon:d.A},sent:{label:"Trimisă",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:c.A},paid:{label:"Plătită",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:o.A},overdue:{label:"Restantă",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:u.A},cancelled:{label:"Anulată",color:"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-500",icon:g.A}};function Q(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RON";return new Intl.NumberFormat("ro-RO",{style:"currency",currency:a,minimumFractionDigits:2}).format(e)}function G(e){return new Date(e).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",year:"numeric"})}function H(e){let{status:a}=e,r=W[a],l=r.icon;return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ".concat(r.color),children:[(0,s.jsx)(l,{className:"w-3.5 h-3.5"}),r.label]})}function J(e){let{status:a}=e;if(!a)return null;let r={pending:{label:"e-Factura: \xcen așteptare",color:"bg-yellow-100 text-yellow-700"},uploaded:{label:"e-Factura: \xcencărcată",color:"bg-blue-100 text-blue-700"},validated:{label:"e-Factura: Validată",color:"bg-green-100 text-green-700"},rejected:{label:"e-Factura: Respinsă",color:"bg-red-100 text-red-700"}},l=r[a]||r.pending;return(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ".concat(l.color),children:l.label})}function K(){var e,a,r,c,o,g;let D=(0,t.useTranslations)("invoices"),{selectedCompanyId:F}=(0,S.o)(),[R,z]=(0,l.useState)(""),[V,P]=(0,l.useState)("all"),[I,O]=(0,l.useState)(1),[E,U]=(0,l.useState)(!1),{data:T,isLoading:M,error:q}=(0,A.WI)(F||"",{page:I.toString(),limit:"10",..."all"!==V&&{status:V},...R&&{search:R}}),{data:L}=(0,A.CV)(F||""),_=(null==T?void 0:null===(e=T.data)||void 0===e?void 0:e.items)||(null==T?void 0:T.data)||[],$=(null==T?void 0:null===(a=T.data)||void 0===a?void 0:a.pagination)||{total:0,pages:1},K=null==L?void 0:L.data,Z=[{label:"Total Facturi",value:(null==K?void 0:K.total)||_.length,color:"text-gray-900 dark:text-white"},{label:"Ne\xeencasate",value:Q((null==K?void 0:null===(r=K.outstanding)||void 0===r?void 0:r.amount)||0),subValue:"".concat((null==K?void 0:null===(c=K.outstanding)||void 0===c?void 0:c.count)||0," facturi"),color:"text-blue-600"},{label:"Restante",value:Q((null==K?void 0:null===(o=K.overdue)||void 0===o?void 0:o.amount)||0),subValue:"".concat((null==K?void 0:null===(g=K.overdue)||void 0===g?void 0:g.count)||0," facturi"),color:"text-red-600"},{label:"\xcencasate Luna Aceasta",value:Q((null==K?void 0:K.paidThisMonth)||0),color:"text-green-600"}];return F?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:D("title")}),(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Gestionează facturile emise către clienți"})]}),(0,s.jsxs)("button",{onClick:()=>U(!0),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[(0,s.jsx)(x.A,{className:"w-5 h-5"}),D("new")]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:Z.map((e,a)=>(0,s.jsxs)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"p-4 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.label}),(0,s.jsx)("p",{className:"text-xl font-bold mt-1 ".concat(e.color),children:e.value}),e.subValue&&(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-0.5",children:e.subValue})]},e.label))}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(m.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Caută după număr, client sau CUI...",value:R,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.A,{className:"w-5 h-5 text-gray-400"}),(0,s.jsxs)("select",{value:V,onChange:e=>P(e.target.value),className:"px-3 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"Toate Statusurile"}),(0,s.jsx)("option",{value:"draft",children:W.draft.label}),(0,s.jsx)("option",{value:"sent",children:W.sent.label}),(0,s.jsx)("option",{value:"paid",children:W.paid.label}),(0,s.jsx)("option",{value:"overdue",children:W.overdue.label}),(0,s.jsx)("option",{value:"cancelled",children:W.cancelled.label})]})]}),(0,s.jsxs)("button",{className:"inline-flex items-center gap-2 px-4 py-2.5 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[(0,s.jsx)(h.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Export"})]})]}),(0,s.jsx)("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-hidden",children:M?(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsx)(p.A,{className:"w-8 h-8 animate-spin text-blue-600"})}):q?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[(0,s.jsx)(u.A,{className:"w-12 h-12 text-red-400 mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Eroare la \xeencărcarea facturilor"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 text-blue-600 hover:underline",children:"\xcencearcă din nou"})]}):0===_.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[(0,s.jsx)(d.A,{className:"w-16 h-16 text-gray-300 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Nicio factură găsită"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:R||"all"!==V?"\xcencearcă să modifici filtrele de căutare":"Creează prima ta factură pentru a \xeencepe"}),!R&&"all"===V&&(0,s.jsxs)(n.default,{href:"/invoices/new",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[(0,s.jsx)(x.A,{className:"w-5 h-5"}),"Creează Factură"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"hidden lg:grid lg:grid-cols-12 gap-4 px-6 py-3 bg-gray-50 dark:bg-gray-900 text-sm font-medium text-gray-500 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"col-span-2",children:"Număr"}),(0,s.jsx)("div",{className:"col-span-3",children:"Client"}),(0,s.jsx)("div",{className:"col-span-2",children:"Data"}),(0,s.jsx)("div",{className:"col-span-2 text-right",children:"Sumă"}),(0,s.jsx)("div",{className:"col-span-2",children:"Status"}),(0,s.jsx)("div",{className:"col-span-1"})]}),(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:_.map((e,a)=>(0,s.jsxs)(i.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.03*a},className:"px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",children:[(0,s.jsxs)("div",{className:"hidden lg:grid lg:grid-cols-12 gap-4 items-center",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)(n.default,{href:"/invoices/".concat(e.id),className:"font-medium text-blue-600 hover:underline",children:e.number}),e.efacturaStatus&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(J,{status:e.efacturaStatus})})]}),(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.clientName}),e.clientCui&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["CUI: ",e.clientCui]})]}),(0,s.jsxs)("div",{className:"col-span-2 text-sm",children:[(0,s.jsx)("p",{children:G(e.issueDate)}),(0,s.jsxs)("p",{className:"text-gray-500",children:["Scadentă: ",G(e.dueDate)]})]}),(0,s.jsxs)("div",{className:"col-span-2 text-right",children:[(0,s.jsx)("p",{className:"font-semibold",children:Q(e.total,e.currency)}),e.items&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[e.items," articole"]})]}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)(H,{status:e.status})}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("button",{className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:(0,s.jsx)(y.A,{className:"w-5 h-5 text-gray-400"})}),(0,s.jsx)("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsxs)(n.default,{href:"/invoices/".concat(e.id),className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,s.jsx)(v.A,{className:"w-4 h-4"}),"Vizualizează"]}),(0,s.jsxs)(n.default,{href:"/invoices/".concat(e.id,"/edit"),className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,s.jsx)(f.A,{className:"w-4 h-4"}),"Editează"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 w-full",children:[(0,s.jsx)(j.A,{className:"w-4 h-4"}),"Duplică"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 w-full",children:[(0,s.jsx)(N.A,{className:"w-4 h-4"}),"Trimite Email"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 w-full",children:[(0,s.jsx)(h.A,{className:"w-4 h-4"}),"Descarcă PDF"]}),(0,s.jsx)("hr",{className:"my-1 border-gray-200 dark:border-gray-700"}),(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 w-full",children:[(0,s.jsx)(k.A,{className:"w-4 h-4"}),"Șterge"]})]})})]})})]}),(0,s.jsxs)("div",{className:"lg:hidden space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.default,{href:"/invoices/".concat(e.id),className:"font-medium text-blue-600",children:e.number}),(0,s.jsx)("p",{className:"font-medium mt-1",children:e.clientName})]}),(0,s.jsx)(H,{status:e.status})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:G(e.issueDate)}),(0,s.jsx)("span",{className:"font-semibold",children:Q(e.total,e.currency)})]}),e.efacturaStatus&&(0,s.jsx)(J,{status:e.efacturaStatus})]})]},e.id))}),$.pages>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Pagina ",I," din ",$.pages," (",$.total," facturi)"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>O(e=>Math.max(1,e-1)),disabled:1===I,className:"p-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)(w.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>O(e=>Math.min($.pages,e+1)),disabled:I===$.pages,className:"p-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)(C.A,{className:"w-5 h-5"})})]})]})]})}),(0,s.jsx)(B,{isOpen:E,onClose:()=>U(!1),onSuccess:()=>{window.location.reload()}})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[(0,s.jsx)(d.A,{className:"w-16 h-16 text-gray-300 mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Selectează o firmă"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Pentru a vedea facturile, selectează mai \xeent\xe2i o firmă din meniul de sus."})]})}},34592:(e,a,r)=>{"use strict";r.d(a,{$n:()=>u,aF:()=>c,jl:()=>o});var s=r(95155),l=r(12115),t=r(40767),i=r(25683),n=r(39124);let d={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[90vw]"};function c(e){let{isOpen:a,onClose:r,title:c,description:o,children:u,size:g="lg",showCloseButton:x=!0}=e;return(0,s.jsx)(i.N,{children:a&&(0,s.jsxs)(l.Fragment,{children:[(0,s.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:r,"aria-hidden":"true"}),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 overflow-y-auto",children:(0,s.jsxs)(n.P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"w-full ".concat(d[g]," bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden"),onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between p-6 border-b border-gray-200 dark:border-gray-800",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:c}),o&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:o})]}),x&&(0,s.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"\xcenchide",children:(0,s.jsx)(t.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,s.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:u})]})})]})})}function o(e){let{children:a}=e;return(0,s.jsx)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/50",children:a})}function u(e){let{children:a,variant:r="primary",type:l="button",disabled:t=!1,isLoading:i=!1,onClick:n,className:d=""}=e;return(0,s.jsx)("button",{type:l,disabled:t||i,onClick:n,className:"px-4 py-2.5 rounded-lg font-medium transition-colors disabled:cursor-not-allowed ".concat({primary:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-blue-400",secondary:"bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-200",danger:"bg-red-600 hover:bg-red-700 text-white disabled:bg-red-400"}[r]," ").concat(d),children:i?(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Se incarca..."]}):a})}}},e=>{var a=a=>e(e.s=a);e.O(0,[4265,3937,7266,8239,8451,9008,814,6135,3139,8441,1517,7358],()=>a(66542)),_N_E=e.O()}]);